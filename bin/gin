#!/usr/bin/env bash
cmd="$@"
source "$(dirname "$(readlink -f "$0")")/ginenv"

assert_valid_runner_set
assert_valid_prefix_set

RUNNER="$(get_runner_path)"
PREFIX="$(get_prefix_path)"

export PATH="$RUNNER/bin:$PATH"
export LD_LIBRARY_PATH="$RUNNER/lib:$LD_LIBRARY_PATH"
export WINEDLLOVERRIDES="winemenubuilder.exe=d;${WINEDLLOVERRIDES}"
export WINESERVER="$RUNNER/bin/wineserver"
export WINELOADER="$RUNNER/bin/wine"
export WINEDLLPATH="$RUNNER/lib/wine:$WINEDLLPATH"
export WINEPREFIX="$PREFIX"

if [ -n "$GIN_DEBUG" ]; then
    echo "Runner Path: $RUNNER"
    echo "Prefix Path: $PREFIX"
    echo "WINEPREFIX: $WINEPREFIX"
    echo "WINEDLLPATH: $WINEDLLPATH"
    echo "WINESERVER: $WINESERVER"
    echo "WINELOADER: $WINELOADER"
    echo "LD_LIBRARY_PATH: $LD_LIBRARY_PATH"
    echo "PATH: $PATH"
    echo "WINEDLLOVERRIDES: $WINEDLLOVERRIDES"
fi

echo "Using runner: $(basename "$RUNNER")"
echo "Using prefix: $(basename "$PREFIX")"
echo "Executing: $cmd"

"$@"